# ============================================================
# Loki Configuration
# 로그 수집 및 저장을 위한 Loki 설정 파일
# ============================================================

# 인증 설정: 단일 인스턴스 환경에서는 비활성화
# 프로덕션에서는 인증 미들웨어를 통한 보안 강화 권장
auth_enabled: false

# ============================================================
# Server Configuration
# ============================================================
server:
  # HTTP 리스닝 포트: Grafana와 Promtail이 접근하는 포트
  http_listen_port: 3100

# ============================================================
# Common Configuration
# ============================================================
common:
  # 데이터 저장 경로: 볼륨 마운트 지점과 일치해야 함
  path_prefix: /loki
  
  # 스토리지 설정: 파일시스템 기반 저장 (단일 인스턴스용)
  storage:
    filesystem:
      chunks_directory: /loki/chunks    # 로그 청크 저장 디렉토리
      rules_directory: /loki/rules      # 알림 규칙 저장 디렉토리
  
  # 복제 팩터: 단일 인스턴스이므로 1로 설정
  replication_factor: 1
  
  # Ring 설정: 분산 환경에서 사용, 단일 인스턴스는 inmemory 사용
  ring:
    kvstore:
      store: inmemory
    instance_addr: "funda-loki"

# ============================================================
# Schema Configuration
# ============================================================
schema_config:
  configs:
    # 스키마 버전 및 저장 형식 설정
    - from: 2020-10-24
      store: tsdb                # 인덱스 저장 형식 (단일 인스턴스용)
      object_store: filesystem   # 객체 저장소: 파일시스템
      schema: v11                # 스키마 버전
      index:
        prefix: index_           # 인덱스 파일 접두사
        period: 24h              # 인덱스 기간 (24시간 단위)

# ============================================================
# Limits Configuration
# ============================================================
limits_config:
  # 로그 보관 기간: 168시간 = 7일
  # 프로덕션에서는 필요에 따라 조정 (예: 30일 = 720h)
  retention_period: 168h
  
  # 오래된 샘플 거부: 보관 기간을 초과한 로그는 자동 삭제
  reject_old_samples: true
  reject_old_samples_max_age: 168h

# ============================================================
# Table Manager Configuration
# ============================================================
table_manager:
  # 보관 기간 초과 데이터 자동 삭제 활성화
  retention_deletes_enabled: true
  retention_period: 168h